function createRTCSessionDescription(t){return new RTCSessionDescription(t)}var gStrH5SPlayerVersion="l5splayer r1.1.0829";function L5sPlayerRTC(t){this.t,this.s,this.i=!1,this.o=!1,this.h=!0,void 0!==t.consolelog&&"false"===t.consolelog&&(this.h=!1),this.l=t,this.u=t.videoid,this.v=t.pbconf,this.S=t.token,this.C=1,void 0===this.u?(this.P=t.videodom,!0===this.h&&console.log("[RTC] use dom directly",t.token)):(this.P=document.getElementById(this.u),!0===this.h&&console.log("[RTC] use videoid",t.token)),this.video=this.P,this.R=null,this.T={optional:[{DtlsSrtpKeyAgreement:!0}]},this.p={mandatory:{offerToReceiveAudio:!0,offerToReceiveVideo:!0}},this.H={iceServers:[]},this.U=[],this.O,void 0!=this.v&&"false"==this.v.showposter||(this.O=this.l.protocol+"//"+this.l.host+this.l.rootpath+"api/v1/GetImage?token="+this.S+"&session="+this.l.session,!0===this.h&&console.log("[WS] connect src",t.token),this.P.setAttribute("poster",this.O))}function L5sRTCPush(t){this.t,this.s,this.i=!1,this.o=!1,this.h=!0,void 0!==t.consolelog&&"false"===t.consolelog&&(this.h=!1),this.l=t,this.u=t.localvideoid,this.J=t.user,this.C=1,void 0===this.u?(this.N=t.localvideodom,!0===this.h&&console.log("[PUSH] use dom directly",t.user)):(this.N=document.getElementById(this.u),!0===this.h&&console.log("[PUSH] use videoid",t.user)),this.video=this.N,this.R=null,this.T={optional:[{DtlsSrtpKeyAgreement:!0}]},this.p={mandatory:{offerToReceiveAudio:!1,offerToReceiveVideo:!1}},this.H={iceServers:[]},this.U=[]}function L5sRTCGetCapability(t,s,i){var o={},n=[],c=[],h=[],r=[];if(null==s);else{var a=s,l=s.resolution,d=1280,u=720;"QVGA"==l?(d=320,u=240):"VGA"==l?(d=640,u=480):"D1"==l?(d=720,u=576):"720P"==l?(d=1280,u=720):"1080P"==l?(d=1920,u=1080):"4K"==l?(d=4096,u=2160):"8K"==l&&(d=7680,u=4320);var f,v,S="",C=!1;void 0!==a.facingmode&&(S=a.facingmode,C=!0);var P=s.localvideoid,R=document.getElementById(P);console.log(R,P,document.getElementById(P))," true"==a.audio?(console.log(a.audio),f={deviceId:{exact:s.audioin}}):f=!1,v="true"==a.video&&(C?{facingMode:{exact:S},width:{exact:d},height:{exact:u}}:{deviceId:{exact:s.videoin},width:{exact:d},height:{exact:u},codec:{exact:s.codec},bitrate:{exact:s.bitrate}}),console.log(s.bitrate);const t={audio:f,video:v};navigator.mediaDevices.getUserMedia(t).then(function(t){t&&null!=R&&(console.log(t),console.log(R),R.srcObject=t,R.play())}).catch(function(t){var e="[PUSH] getUserMedia failed: "+t.name+" "+t.message;alert(e)})}if(null!=t){if(window.RTCRtpTransceiver&&"setCodecPreferences"in window.RTCRtpTransceiver.prototype){const t=window.RTCRtpSender.getCapabilities("video").codecs;var T=!1,p=!1;for(let e=0;e!==t.length;++e){const s=t[e];["video/red","video/ulpfec","video/rtx"].includes(s.mimeType)||(["video/VP9"].includes(s.mimeType)?T=!0:["video/H264"].includes(s.mimeType)&&(p=!0))}1==T&&n.push("VP9"),1==p&&n.push("H264")}else n.push("Default");navigator.mediaDevices.enumerateDevices().then(function(e){for(let t=0;t!==e.length;++t){const i=e[t];var s={};s.id=i.deviceId,s.name=i.label,"audioinput"===i.kind?c.push(s):"audiooutput"===i.kind?h.push(s):"videoinput"===i.kind&&r.push(s)}o.videocodec=n,o.videoin=r,o.audioin=c,o.audioout=h,t(o),console.log(r)}).catch(function(s){null!=t&&alert("[PUSH] enumerateDevices failed",e)})}}console.log("[l5s]",gStrH5SPlayerVersion),L5sPlayerRTC.prototype.g=function(){if(!0===this.i){!0===this.h&&console.log("[RTC] Reconnect...");var t=this.O+"&update="+this.C;this.P.setAttribute("poster",t),!0===this.h&&console.log("[RTC] Reconnect image",t),this.C++,this.m(this.S),this.i=!1}},L5sPlayerRTC.prototype.L=function(t){var e;!0===this.h&&console.log("[RTC] H5SWebSocketClient");try{"http:"==this.l.protocol&&(e="undefined"!=typeof MozWebSocket?new MozWebSocket("ws://"+this.l.host+t):new WebSocket("ws://"+this.l.host+t)),"https:"==this.l.protocol&&(!0===this.h&&console.log(this.l.host),e="undefined"!=typeof MozWebSocket?new MozWebSocket("wss://"+this.l.host+t):new WebSocket("wss://"+this.l.host+t)),!0===this.h&&console.log(this.l.host)}catch(t){return void alert("error")}return e},L5sPlayerRTC.prototype.I=function(){try{var t={type:"keepalive"};this.t.send(JSON.stringify(t))}catch(t){!0===this.h&&console.log(t)}},L5sPlayerRTC.prototype.k=function(t){if(t.candidate){var e;!0===this.h&&console.log("[RTC] onIceCandidate currentice",t.candidate),e=t.candidate,!0===this.h&&console.log("[RTC] onIceCandidate currentice",JSON.stringify(e));var s=JSON.parse(JSON.stringify(e));s.type="remoteice",!0===this.h&&console.log("[RTC] onIceCandidate currentice new",JSON.stringify(s)),this.t.send(JSON.stringify(s))}else!0===this.h&&console.log("End of candidates.")},L5sPlayerRTC.prototype.M=function(t){var e;!0===this.h&&console.log("[RTC] Remote track added:"+JSON.stringify(t)),e=t.W?t.W[0]:t.stream;var s=this.P;s.srcObject=e,s.play()},L5sPlayerRTC.prototype.A=function(){!0===this.h&&console.log("[RTC] createPeerConnection  config: "+JSON.stringify(this.H)+" option:"+JSON.stringify(this.T));var t=new RTCPeerConnection(this.H,this.T),e=this;return t.onicecandidate=function(t){e.k.call(e,t)},void 0!==t.D?t.D=function(t){e.M.call(e,t)}:t.onaddstream=function(t){e.M.call(e,t)},t.oniceconnectionstatechange=function(s){!0===e.h&&console.log("[RTC] oniceconnectionstatechange  state: "+t.iceConnectionState)},!0===this.h&&console.log("[RTC] Created RTCPeerConnnection with config: "+JSON.stringify(this.H)+"option:"+JSON.stringify(this.T)),t},L5sPlayerRTC.prototype.V=function(t){!0===this.h&&console.log("[RTC] ProcessRTCOffer",t);try{this.R=this.A(),this.U.length=0;var e=this;!0===this.h&&console.log("[RTC] createRTCSessionDescription "),this.R.setRemoteDescription(createRTCSessionDescription(t)),this.R.createAnswer(this.p).then(function(t){!0===e.h&&console.log("[RTC] Create answer:"+JSON.stringify(t)),e.R.setLocalDescription(t,function(){!0===e.h&&console.log("[RTC] ProcessRTCOffer createAnswer",t),e.t.send(JSON.stringify(t))},function(){})},function(t){alert("[RTC] Create awnser error:"+JSON.stringify(t))})}catch(t){this.disconnect(),alert("[RTC] connect error: "+t)}},L5sPlayerRTC.prototype.G=function(t){!0===this.h&&console.log("[RTC] ProcessRemoteIce",t);try{var e=new RTCIceCandidate({sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate});!0===this.h&&console.log("[RTC] ProcessRemoteIce",e),!0===this.h&&console.log("[RTC] Adding ICE candidate :"+JSON.stringify(e)),this.R.addIceCandidate(e,function(){},function(t){console.log("[RTC] addIceCandidate error:"+JSON.stringify(t))})}catch(t){alert("connect ProcessRemoteIce error: "+t)}},L5sPlayerRTC.prototype.K=function(t){t.data,ArrayBuffer,t.data,!0===this.h&&console.log("[RTC] RTC received ",t.data);var e=JSON.parse(t.data);return!0===this.h&&console.log("[RTC] Get Message type ",e.type),"offer"===e.type?(!0===this.h&&console.log("[RTC] Process Message type ",e.type),void this.V(e)):"iceserver"===e.type?(!0===this.h&&console.log("[RTC] Process Message type ",e.type),this.H.iceServers=e.iceServers,this.H.iceTransportPolicy=e.iceTransportPolicy,void(!0===this.h&&console.log("[RTC] Iceserver:",this.H))):"remoteice"===e.type?(!0===this.h&&console.log("[RTC] Process Message type ",e.type),void this.G(e)):void(void 0!=this.v&&void 0!=this.v.callback&&this.v.callback(t.data,this.v.userdata))},L5sPlayerRTC.prototype.m=function(t){this.video.autoplay=!0;var e="api/v1/h5srtcapi",s="main";if(void 0===this.l.streamprofile||(s=this.l.streamprofile),void 0===this.v)e=this.l.rootpath+e+"?token="+t+"&profile="+s+"&session="+this.l.session;else{var i="false",o="fake";void 0===this.v.serverpb||(i=this.v.serverpb),void 0===this.v.filename||(o=this.v.filename),e=this.l.rootpath+e+"?token="+t+"&playback=true&profile="+s+"&serverpb="+i+"&begintime="+encodeURIComponent(this.v.begintime)+"&endtime="+encodeURIComponent(this.v.endtime)+"&filename="+o+"&session="+this.l.session}!0===this.h&&console.log(e),this.t=this.L(e),!0===this.h&&console.log("[RTC] setupWebSocket",this.t),this.t.binaryType="arraybuffer",this.t._=this,this.t.onmessage=this.K.bind(this),this.t.onopen=function(){!0===this._.h&&console.log("[RTC] wsSocket.onopen",this._);var t={type:"open"};this._.t.send(JSON.stringify(t)),this._.s=setInterval(this._.I.bind(this._),1e3),void 0!=this._.v&&"true"===this._.v.autoplay&&this._.start()},this.t.onclose=function(){!0===this.h&&console.log("[RTC] wsSocket.onclose",this._),!0===this._.o?!0===this._.h&&console.log("[RTC] wsSocket.onclose disconnect"):this._.i=!0,this._.B(this._)}},L5sPlayerRTC.prototype.B=function(t){!0===t.h&&console.log("[RTC] CleanupWebSocket",t),clearInterval(t.s)},L5sPlayerRTC.prototype.connect=function(){this.m(this.S),this.j=setInterval(this.g.bind(this),3e3)},L5sPlayerRTC.prototype.disconnect=function(){if(!0===this.h&&console.log("[RTC] disconnect",this),this.o=!0,clearInterval(this.j),null!=this.t&&(this.t.close(),this.t=null),this.P&&(this.P.src=""),this.R){try{this.R.close()}catch(t){!0===this.h&&console.log("[RTC] close peer connection failed:"+t)}this.R=null}!0===this.h&&console.log("[RTC] disconnect",this)},L5sPlayerRTC.prototype.start=function(){try{var t={cmd:"H5_START"};this.t.send(JSON.stringify(t))}catch(t){!0===this.h&&console.log(t)}},L5sPlayerRTC.prototype.pause=function(){try{var t={cmd:"H5_PAUSE"};this.t.send(JSON.stringify(t))}catch(t){!0===this.h&&console.log(t)}},L5sPlayerRTC.prototype.resume=function(){try{var t={cmd:"H5_RESUME"};this.t.send(JSON.stringify(t))}catch(t){!0===this.h&&console.log(t)}},L5sPlayerRTC.prototype.seek=function(t){try{var e={cmd:"H5_SEEK"};e.nSeekTime=t,this.t.send(JSON.stringify(e))}catch(t){!0===this.h&&console.log(t)}},L5sPlayerRTC.prototype.speed=function(t){try{var e={cmd:"H5_SPEED"};e.nSpeed=t,this.t.send(JSON.stringify(e))}catch(t){!0===this.h&&console.log(t)}},L5sRTCPush.prototype.g=function(){!0===this.i&&(!0===this.h&&console.log("[PUSH] Reconnect..."),this.m(this.J),this.i=!1)},L5sRTCPush.prototype.L=function(t){var e;!0===this.h&&console.log("[PUSH] H5SWebSocketClient");try{"http:"==this.l.protocol&&(e="undefined"!=typeof MozWebSocket?new MozWebSocket("ws://"+this.l.host+t):new WebSocket("ws://"+this.l.host+t)),"https:"==this.l.protocol&&(!0===this.h&&console.log(this.l.host),e="undefined"!=typeof MozWebSocket?new MozWebSocket("wss://"+this.l.host+t):new WebSocket("wss://"+this.l.host+t)),!0===this.h&&console.log(this.l.host)}catch(t){return void alert("error")}return e},L5sRTCPush.prototype.I=function(){try{var t={type:"keepalive"};this.t.send(JSON.stringify(t))}catch(t){!0===this.h&&console.log(t)}},L5sRTCPush.prototype.k=function(t){if(t.candidate){var e;!0===this.h&&console.log("[PUSH] onIceCandidate currentice",t.candidate),e=t.candidate,!0===this.h&&console.log("[PUSH] onIceCandidate currentice",JSON.stringify(e));var s=JSON.parse(JSON.stringify(e));s.type="remoteice",!0===this.h&&console.log("[PUSH] onIceCandidate currentice new",JSON.stringify(s)),this.t.send(JSON.stringify(s))}else!0===this.h&&console.log("End of candidates.")},L5sRTCPush.prototype.M=function(t){!0===this.h&&console.log("[PUSH] Remote track added:"+JSON.stringify(t)),t.W?t.W[0]:t.stream},L5sRTCPush.prototype.A=function(){!0===this.h&&console.log("[PUSH] createPeerConnection  config: "+JSON.stringify(this.H)+" option:"+JSON.stringify(this.T));var t=new RTCPeerConnection(this.H,this.T),e=this;return t.onicecandidate=function(t){e.k.call(e,t)},void 0!==t.D?t.D=function(t){e.M.call(e,t)}:t.onaddstream=function(t){e.M.call(e,t)},t.oniceconnectionstatechange=function(s){!0===e.h&&console.log("[PUSH] oniceconnectionstatechange  state: "+t.iceConnectionState)},!0===this.h&&console.log("[PUSH] Created RTCPeerConnnection with config: "+JSON.stringify(this.H)+"option:"+JSON.stringify(this.T)),t},L5sRTCPush.prototype.q=function(t,e){if(("chrome"===adapter.browserDetails.browser||"safari"===adapter.browserDetails.browser||"firefox"===adapter.browserDetails.browser&&adapter.browserDetails.version>=64)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){const s=t.getSenders();for(let t=0;t!==s.length;++t){const i=s[t];if("video"==i.track.kind){const t=i.getParameters();t.encodings||(t.encodings=[{}]),t.encodings[0].maxBitrate=1e3*e,i.setParameters(t).then(()=>{}).catch(t=>console.error(t))}}}},L5sRTCPush.prototype.F=function(){!0===this.h&&console.log("[PUSH] CreateOffer");try{this.R=this.A(),this.U.length=0;var t=this;const i=this.X.getVideoTracks(),o=this.X.getAudioTracks();i.length>0&&console.log("[PUSH] Using video device:",i[0].label),o.length>0&&console.log("[PUSH] Using audio device:",o[0].label),this.X.getTracks().forEach(t=>this.R.addTrack(t,this.X));const n=window.RTCRtpTransceiver&&"setCodecPreferences"in window.RTCRtpTransceiver.prototype;try{if(n){var e="video/H264";"VP9"==this.Y?e="video/VP9":"H264"==this.Y&&(e="video/H264");const i=window.RTCRtpSender.getCapabilities("video").codecs;var s=[];for(let t=0;t!==i.length;++t){const o=i[t];[e].includes(o.mimeType)&&s.push(o)}!0===t.h&&console.log("[PUSH] Select codec:",s),this.R.getTransceivers().find(t=>t.sender&&t.sender.track===this.X.getVideoTracks()[0]).setCodecPreferences(s)}}catch(t){}return void this.R.createOffer(this.p).then(function(e){!0===t.h&&console.log("[PUSH] Create offer:"+JSON.stringify(e)),t.R.setLocalDescription(e,function(){var s=e;t.t.send(JSON.stringify(s))},function(){})},function(t){alert("[PUSH ]Create offer error:"+JSON.stringify(t))})}catch(t){this.disconnect(),alert("connect error: "+t)}},L5sRTCPush.prototype.Z=function(t){!0===this.h&&console.log("[PUSH] ProcessAnswer",t);try{this.R.setRemoteDescription(createRTCSessionDescription(t))}catch(t){this.disconnect(),alert("connect error: "+t)}this.q(this.R,this.$)},L5sRTCPush.prototype.G=function(t){!0===this.h&&console.log("[PUSH] ProcessRemoteIce",t);try{var e=new RTCIceCandidate({sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate});!0===this.h&&console.log("[PUSH] ProcessRemoteIce",e),!0===this.h&&console.log("[PUSH] Adding ICE candidate :"+JSON.stringify(e)),this.R.addIceCandidate(e,function(){},function(t){console.log("[PUSH] addIceCandidate error:"+JSON.stringify(t)),console.log(t)})}catch(t){alert("connect ProcessRemoteIce error: "+t)}},L5sRTCPush.prototype.K=function(t){t.data,ArrayBuffer,t.data,!0===this.h&&console.log("[PUSH] RTC received ",t.data);var e=JSON.parse(t.data);return!0===this.h&&console.log("[PUSH] Get Message type ",e.type),"iceserver"===e.type?(!0===this.h&&console.log("[PUSH] Process Message type ",e.type),this.H.iceServers=e.iceServers,!0===this.h&&console.log("[PUSH] Iceserver:",this.H),void this.F()):"answer"===e.type?(!0===this.h&&console.log("[PUSH] Process Message type ",e.type),void this.Z(e)):"remoteice"===e.type?(!0===this.h&&console.log("[PUSH] Process Message type ",e.type),void this.G(e)):void(void 0!=this.l.callback&&this.l.callback(t.data,this.l.userdata))},L5sRTCPush.prototype.m=function(t){this.video.autoplay=!0;var e="api/v1/h5srtcpushapi";e=this.l.rootpath+e+"?token="+t+"&conftoken="+this.tt+"&type="+this.l.type+"&session="+this.l.session,!0===this.h&&console.log(e),this.t=this.L(e),!0===this.h&&console.log("[PUSH] setupWebSocket",this.t),this.t.binaryType="arraybuffer",this.t._=this,this.t.onmessage=this.K.bind(this),this.t.onopen=function(){!0===this._.h&&console.log("[PUSH] wsSocket.onopen",this._);var t={type:"open"};this._.t.send(JSON.stringify(t)),this._.s=setInterval(this._.I.bind(this._),1e3),void 0!=this._.v&&"true"===this._.v.autoplay&&this._.start()},this.t.onclose=function(){!0===this.h&&console.log("[PUSH] wsSocket.onclose",this._),!0===this._.o?!0===this._.h&&console.log("[PUSH] wsSocket.onclose disconnect"):this._.i=!0,this._.B(this._)}},L5sRTCPush.prototype.B=function(t){!0===t.h&&console.log("[PUSH] CleanupWebSocket",t),clearInterval(t.s)},L5sRTCPush.prototype.connect=function(t,e){this.et=e,this.tt=t,this.st=e.videoin,this.Y=e.codec,this.$=e.bitrate,this.it=e.resolution,this.ot=e.audioin,!0===this.h&&console.log("[PUSH] videoin:",e.videoin,"codec:",e.codec,"bitrate:",e.bitrate,"resolution:",e.resolution,"audioin:",e.audioin);var s,i,o=1280,n=720;"QVGA"==e.resolution?(o=320,n=240):"VGA"==e.resolution?(o=640,n=480):"D1"==e.resolution?(o=720,n=576):"720P"==e.resolution?(o=1280,n=720):"1080P"==e.resolution?(o=1920,n=1080):"4K"==e.resolution?(o=4096,n=2160):"8K"==e.resolution&&(o=7680,n=4320);var c="",h=!1;void 0!==this.et.facingmode&&(c=this.et.facingmode,!0===this.h&&console.log("[PUSH] facing mode:",c),h=!0),s="true"==this.et.audio&&{deviceId:{exact:e.audioin}},i="true"==this.et.video&&(h?{facingMode:{exact:c},width:{exact:o},height:{exact:n}}:{deviceId:{exact:e.videoin},width:{exact:o},height:{exact:n}}),console.log(e.videoin);try{console.log(e.videoin);const t={audio:s,video:i};try{var r=this;0==this.et.desktopshare?navigator.mediaDevices.getUserMedia(t).then(function(t){r.N.srcObject=t,r.X=t,r.m(r.J)}).catch(function(t){var e="[PUSH] getUserMedia failed: "+t.name+" "+t.message;alert(e)}):navigator.mediaDevices.getDisplayMedia({video:!0}).then(function(t){r.N.srcObject=t,r.X=t,r.m(r.J)}).catch(function(t){alert("[PUSH] getUserMedia failed:",t.name+": "+t.message)})}catch(t){var a="[PUSH] getUserMedia failed: "+err.name+" "+err.message;return void alert(a)}}catch(t){return void(!0===this.h&&console.log(t))}},L5sRTCPush.prototype.send=function(t,e){var s={type:"message"};s.user=this.J,s.token=t,s.msg=e,this.t.send(JSON.stringify(s))},L5sRTCPush.prototype.disconnect=function(){if(!0===this.h&&console.log("[PUSH] disconnect",this),this.o=!0,clearInterval(this.j),null!=this.t&&(this.t.close(),this.t=null),this.N&&(this.N.src=""),this.R){try{this.R.close()}catch(t){!0===this.h&&console.log("[PUSH] close peer connection failed:"+t)}this.R=null}!0===this.h&&console.log("[PUSH] disconnect",this)};

export  {L5sPlayerRTC,L5sRTCPush,L5sRTCGetCapability}